{% extends "base.html" %} {% block title %}{% if page %}{{ page.title }} - {%
endif %}{{ SITENAME }}{% endblock %} {% block content %} {% if page %}
<div class="page-header">
  <div class="container">
    <h1>{{ page.title }}</h1>
  </div>
</div>

<div class="container">
  <div class="page-content">{{ page.content }}</div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Mover introdução para team-introduction
    const intro = document.querySelector(".page-content > p:first-child");
    if (intro) {
      const introDiv = document.createElement("div");
      introDiv.className = "team-introduction";
      introDiv.appendChild(intro.cloneNode(true));
      intro.before(introDiv);
      intro.remove();
    }

    // Selecionar todas as seções de equipe
    const sections = document.querySelectorAll(".page-content h2");
    sections.forEach((section) => {
      const grid = document.createElement("div");
      grid.className = "team-grid";

      // Coletar todos os membros da seção
      const members = [];
      let nextElement = section.nextElementSibling;

      while (nextElement && nextElement.tagName !== "H2") {
        if (nextElement.tagName === "H3") {
          members.push(nextElement);
        }
        nextElement = nextElement.nextElementSibling;
      }

      // Processar cada membro
      members.forEach((nameElement) => {
        const memberDiv = document.createElement("div");
        memberDiv.className = "team-member";

        const name = nameElement.textContent.trim();
        let imgSrc = "{{ SITEURL }}/images/equipe/default.jpg";
        let role = "";
        let description = "";

        // Avançar pelos irmãos até o próximo H3 ou H2
        let currentElement = nameElement.nextElementSibling;
        console.log(currentElement);

        while (
          currentElement &&
          currentElement.tagName !== "H3" &&
          currentElement.tagName !== "H2"
        ) {
          if (currentElement.tagName === "P") {
            const img = currentElement.querySelector("img");
            const strong = currentElement.querySelector("strong");

            if (img && !imgSrc.includes("ana-silva.jpg")) {
              // Evitar sobrescrever se já encontrado
              imgSrc = img.src;
            } else if (strong && !role) {
              // Capturar cargo apenas se ainda não encontrado
              role = strong.textContent.trim();
            } else if (
              !description &&
              !currentElement.querySelector("img") &&
              !currentElement.querySelector("strong")
            ) {
              description = currentElement.textContent.trim(); // Capturar descrição se não for imagem ou cargo
            }
          }
          currentElement = currentElement.nextElementSibling;
        }

        memberDiv.innerHTML = `
          <div class="team-photo">
            <img src="${imgSrc}" alt="${name}">
          </div>
          <div class="team-info">
            <h3>${name}</h3>
            <span class="team-role">${role}</span>
            <p>${description}</p>
          </div>
        `;

        grid.appendChild(memberDiv);

        // Remover os elementos originais
        currentElement = nameElement.nextElementSibling;
        while (
          currentElement &&
          currentElement.tagName !== "H3" &&
          currentElement.tagName !== "H2"
        ) {
          const next = currentElement.nextElementSibling;
          currentElement.remove();
          currentElement = next;
        }
        nameElement.remove();
      });

      // Adicionar o grid após a seção
      section.insertAdjacentElement("afterend", grid);
      section.className = "team-section";
    });
  });
</script>
{% else %}
<div class="container">
  <div class="page-content">
    <h1>Equipe não encontrada</h1>
    <p>O conteúdo solicitado não está disponível.</p>
  </div>
</div>
{% endif %} {% endblock %}
